<!doctype html>
<html>
  <meta charset="utf-8">
  
  <head>
    <title>WEBPOKER</title>
    <link rel="stylesheet" href="page_style.css">
  </head>
  
  <body>
    <h1>MAV POKER</h1>
    <hr>
  <div id="landing_page" style="display: block;">
    
    <div id="landing_opts">
      <p>
        <button name="new_game" onclick="onNewGame()">New Game</button>
        <br>
        <button name="join_game" onclick="onJoinGame()">Join Game</button>
      </p>
    </div> <!-- landing_opts -->
    
    <div id="join_game_opts" hidden>
      <h4>Join Game</h4>
      <p>Room PIN: <input id="join_room" placeholder="Enter room pin" type="number"></p>
      <p>Name: <input id="player_name" placeholder="Enter your name" type="text"></p>
      <p><input type="button" name="join_room" value="Join Room" onclick="joinRoom()"></p>
    </div> <!--join_room_opts-->
    
    <div id="new_game_opts" hidden>
      <h4>New Game</h4>
      <p>Name: <input id="leader_name" placeholder="Enter your name" type="text"></p>
      <p>Starting Balance: <input id="starting_balance" placeholder="Enter starting balance" type="number" min="50"></p>
      <p>Private: <input type="checkbox" id="visibility" ></p>
      <p><input type="button" name="join_room" value="Join Room" onclick="joinRoom()"></p>
    </div>
  </div> <!-- landing page -->
  
  <div id="game_page" hidden>
    <div id="game_hud">
      <p>
        balance: 
      </p>
    </div>
    
    <div id="cards">
      <p>
        <input type="checkbox" id="card1" onchange="onCardClick('card1')"/>
        <label for="card1"><img src="3C.svg" /></label>
        
        <input type="checkbox" id="card2" onchange="onCardClick('card2')"/>
        <label for="card2"><img src="4D.svg" /></label>
        
        <input type="checkbox" id="card3" onchange="onCardClick('card3')"/>
        <label for="card3"><img src="AS.svg" /></label>
        
        <input type="checkbox" id="card4" onchange="onCardClick('card4')"/>
        <label for="card4"><img src="TH.svg" /></label>
        
        <input type="checkbox" id="card5" onchange="onCardClick('card5')"/>
        <label for="card5"><img src="JC.svg"/></label>
      </p>
    </div> <!-- cards -->
    
    <div id="game_buttons">
      <p>
        <button name="call" onclick="onCall()">Call</button>
        <button name="check" onclick="onCheck()">Check</button>
        <button name="fold" onclick="onFold()">Fold</button>
        
        <button name="raise" onclick="onRaise()">Raise</button>
        <input id="raise_amount" placeholder="Raise amount" type="number" min="0.01">
      </p>
      
      <br>
      
      <p><input type="button" name="swap" value="Swap selected" onclick="onSwap()" disabled></p>
    </div> <!-- game_buttons -->
  </div> <!-- game_page -->
  
  <hr>
  <p><input type="button" name="back_to_main" value="Main Menu" onclick="onBackToMain()"></p>
</body>

</html>
<script>
  
  var connection = null;

  var serverUrl;
  serverUrl = "ws://" + window.location.hostname + ":8881";

  connection = new WebSocket(serverUrl);
  connection.onopen = function (evt) {
    console.log("open");
  }

  var cardIdx = 0;
  var playerId;
  var roomId;

  connection.onclose = function (evt) {
    console.log("close")
  }

  connection.onmessage = function (evt) {
    // This is a hack for this example.
    // The only time the WebPoker server sends data just
    // to this client is at the beginging, when the connection
    // is first made.  The first communication tells us which
    // connection number we are, which is very import.
    // So, we detect this situation where it is not game state

    // Take the msg and turn it into a javascript object
    var msg = evt.data
    const obj = JSON.parse(msg);

    console.log(obj)

    if (!obj.players) {
      playerId = obj.id
      roomId = obj.id

      console.log("player ID = " + playerId)
    } else {
      console.log(obj.rooms.roomId)

      console.log("game state received: " + evt.data)
    }
  }

  function onRaise() {
    var textbox = document.getElementById("raise_amount")
    
    var amount = textbox.value

    var evt = {
      event: "RAISE",
      roomID: roomID,
      playerID: playerId,
      msg: [amount]
    }

    connection.send(JSON.stringify(evt))
    console.log(JSON.stringify(evt))
  }

  function onNewGame() {
    var landing_opts = document.getElementById("landing_opts")
    var new_game_opts = document.getElementById("new_game_opts")

    landing_opts.style.display = "none"
    new_game_opts.style.display = "block"
  }

  function onBackToMain() {
    var landing_page = document.getElementById("landing_page")
    var game_page = document.getElementById("game_page")
    
    var landing_opts = document.getElementById("landing_opts")
    var new_game_opts = document.getElementById("new_game_opts")
    var join_game_opts = document.getElementById("join_game_opts")


    landing_page.style.display = "block"
    game_page.style.display = "none"

    landing_opts.style.display = "block"
    new_game_opts.style.display = "none"
    join_game_opts.style.display = "none" 
  }

  var cardsClicked = 0

  function onCardClick(id) {
    card = document.getElementById(id)
    
    if (cardsClicked == 3 && card.checked == true) {
      card.checked = false;
    } else if (cardsClicked < 3 && card.checked == true) {
      cardsClicked++
    } else if (card.checked == false) {
      cardsClicked--
    }

    console.log(cardsClicked)
  }

  function onJoinGame () {
    var landing_opts = document.getElementById("landing_opts")
    var join_game_opts = document.getElementById("join_game_opts")

    landing_opts.style.display = "none"
    join_game_opts.style.display = "block"
  }

  /* Author: Waseem Alkasbutrus
   * Last Updated: 04/1/2022
   * 
   * joinRoom(): called whenever a user clicks on the join room button
   */
  function joinRoom() {
    var joinRoomId = document.getElementById("join_room").value
    var name = document.getElementById("player_name").value
    
    roomId = joinRoomId
    
    var joinEvt = {
      event: JOIN_ROOM,
      roomID: -1,
      playerID: playerId,
      msg: [joinRoomId, name]
    }

    connection.send(JSON.stringify(joinEvt));
    console.log(JSON.stringify(joinEvt));

    var landing_page = document.getElementById("landing_page")
    var game_page = document.getElementById("game_page")

    landing_page.style.display = "none"
    game_page.style.display = "block"
  }

  function createRoom() {
    var leaderName = document.getElementById("leader_name").value
    var startingBalance = document.getElementById("starting_balance").value
    var visibility = document.getElementById("visibility").checked

    if (visibility) {
      visibility = PRIVATE
    } else {
      visibility = PUBLIC
    }

    var evt = {
      event: CREATE_ROOM,
      roomID: roomId,
      playerID: playerID,
      msg: [leaderName, startingBalance, visibility]
    }

    connection.send(JSON.stringify(evt))
    console.log(JSON.stringify(evt))

    var landing_page = document.getElementById("landing_page")
    var game_page = document.getElementById("game_page")

    landing_page.style.display = "none"
    game_page.style.display = "block"
  }
</script>